---
title: "títol entrega"
subtitle: "Anàlisi de Dades. Repàs 1er parcial"
author: "Gerard Ribas Acebes"
date: today
format:
  html:
    theme: darkly #lumen
    toc: true
    toc-depth: 3
    embed-resources: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, warning = FALSE, message = FALSE)
library(tidyverse)
library(MASS)
library(Hotelling)
library(GGally)
```

# Resum

# Plantejament del problema

# Anàlisi descriptiva
### Simulació de dades
```{r}
mitj <- c(6.5, 450, 185, 770)
covariances <- matrix(c( 4,  54,  24,    60,
                        54, 900, 270,   600,
                        24, 270, 225,   600,
                        60, 600, 600, 10000), nrow = 4)
                        
set.seed(13112024)
n <- 150
dades_quant <- mvrnorm(n, mu = mitj, Sigma = covariances)
dades_quant[,1] <- pmin(pmax(round(dades_quant[,1], 1), 2.5), 12.5)
dades_quant[,2] <- pmin(pmax(round(dades_quant[,2]), 300), 500)
dades_quant[,3] <- pmin(pmax(round(dades_quant[,3]), 130), 250)
dades_quant[,4] <- pmax(round(dades_quant[,4], 2), 200)

veles <- data.frame(
    m2       = round(dades_quant[,1], 1),
    gratil   = round(dades_quant[,2]),
    botavara = round(dades_quant[,3]),
    preu     = round(dades_quant[,4], 2),
    gama     = ordered(sample(1:3, 150, replace = TRUE), labels = c("Baixa", "Mitjana", "Alta")),
    politges = ordered(sample(1:3, 150, replace = TRUE), labels = c(2,3,4)),
    reforç   = ordered(sample(1:3, 150, replace = TRUE), labels = c("Cap", "Finestra", "Vela")),
    material = ordered(sample(1:2, 150, replace = TRUE), labels = c("PVC", "Monofilm")),
    marca    = ordered(sample(1:3, 150, replace = TRUE), labels = c("Neil Pryde", "Gaastra", "North"))
)
```

### Matriu de gràfics de dispersió
```{r}
ggpairs(veles %>% dplyr::select(c(1:4, 8)), aes(colour = material, alpha = 0.8))
```

# Anàlisi inferencial
### Multinomial (reforç)
Calculem la probabilitat que en una mostra de 20 veles hagi més veles reforçades completament que només de finestra, i més de finestra que no reforçades.
```{r}
freq <- table(as.data.frame(veles[,7]))
prop <- freq / n
```

```{r}
# Amb simulacions
nsim <- 3000
set.seed(1714)
sim <- rmultinom(nsim, 20, prop)
sum((sim[1,] <= sim[2,]) & (sim[2,] <= sim[3,])) / nsim
```

```{r}
# Sumant totes les probabilitats
# tots els possibles vectors (x1,x2,x3) tq x1 <= x2 <= x3
probabilitat <- 0
for (cap in seq(0,10)) {
  for (finestra in seq(cap, 20 - cap)) {
    vela <- 20 - finestra - cap
    if (vela >= finestra)
      probabilitat <- probabilitat + dmultinom(c(cap, finestra, vela), 20, prob = prop)
  }
}

# la variable `probabilitat` és aproximandament el que ens ha donat abans amb les simulacions
```

### Regressió múltiple
```{r}
summary(lm(preu ~ m2+gratil+botavara, data = veles))
```

```{r}
summary(lm(preu ~ gratil+botavara, data = veles))
```

```{r}
summary(lm(preu ~ botavara, data = veles))
```

```{r}
data_lm <- data.frame(x = veles$botavara, y = veles$preu)
ggplot(data_lm, aes(x=x, y=y)) +
  geom_point() +
  geom_smooth(method=lm , color="red", se=FALSE)
```

### Contrast d'hipòtesi de dues mitjanes multivariants
```{r}
X1 <- veles %>% filter(material == "Monofilm") %>% dplyr::select(1:4)
X2 <- veles %>% filter(material == "PVC")      %>% dplyr::select(1:4)
```

Amb `hotelling.test`
```{r}
fit <- hotelling.test(X1, X2, var.equal = T)
fit
```

Manualment
```{r}
p  <- 4
n1 <- nrow(X1)
n2 <- nrow(X2)

mu1 <- colMeans(X1)
mu2 <- colMeans(X2)
mu_diff <- matrix(mu1-mu2, ncol = 1)

factor <- (n1+n2-1-p) / ((n1+n2-2)*p) * (n1*n2) / (n1+n2)
S      <- (n1*cov(X1) + n2*cov(X2)) / (n1+n2-2)
Sinv   <- solve(S)

estadisticF <- factor * (t(mu_diff) %*% Sinv %*% mu_diff)
1-pf(estadisticF, p, n1+n2-1-p)
```

aquest estadistic segueix una F de Fisher amb (p, n1+n2-1-p) graus de lliberat.

# Conclusions

# Bibliografia
